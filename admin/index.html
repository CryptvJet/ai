<!DOCTYPE html>
<html lang="en">
<head>
    <meta charset="UTF-8">
    <meta name="viewport" content="width=device-width, initial-scale=1.0">
    <title>AI Admin Panel</title>
    <link rel="stylesheet" href="../css/admin.css">
</head>
<body>
    <div class="admin-container">
        <header class="admin-header">
            <h1>üõ†Ô∏è My AI Admin Panel</h1>
            <div class="header-actions">
                <button onclick="location.href='../index.html'" class="btn-back">‚Üê Back to Chat</button>
                <button onclick="saveAllSettings()" class="btn-save">üíæ Save All</button>
                <button onclick="logout()" class="btn-logout">üö™ Logout</button>
            </div>
        </header>

        <nav class="admin-nav">
            <button class="nav-btn active" onclick="showSection('identity')">ü§ñ Identity</button>
            <button class="nav-btn" onclick="showSection('responses')">üí¨ Responses</button>
            <button class="nav-btn" onclick="showSection('conversations')">üìä Conversations</button>
            <button class="nav-btn" onclick="showSection('integrations')">üîó Integrations</button>
            <button class="nav-btn" onclick="showSection('learning')">üß† Learning</button>
            <button class="nav-btn" onclick="showSection('console')">üîç Console</button>
        </nav>

        <main class="admin-content">
            <!-- Identity Section -->
            <section id="identity" class="admin-section active">
                <h2>AI Identity & Personality</h2>
                
                <div class="form-group">
                    <label for="aiName">AI Name:</label>
                    <input type="text" id="aiName" value="ai" placeholder="Current AI name">
                    <small>The AI can suggest its own name based on conversations</small>
                </div>

                <div class="form-group">
                    <label for="personality">Personality Traits:</label>
                    <textarea id="personality" rows="3" placeholder="helpful,analytical,curious,friendly">helpful,analytical,curious</textarea>
                    <small>Comma-separated personality traits</small>
                </div>

                <div class="form-group">
                    <label for="responseStyle">Response Style:</label>
                    <select id="responseStyle">
                        <option value="conversational">Conversational</option>
                        <option value="formal">Formal</option>
                        <option value="casual">Casual</option>
                        <option value="technical">Technical</option>
                    </select>
                </div>

                <div class="form-group">
                    <label for="systemPrompt">System Prompt:</label>
                    <textarea id="systemPrompt" rows="5" placeholder="Base instructions for the AI...">You are an AI assistant specialized in analyzing PulseCore simulations and helping with data analysis. You have access to nova events, pattern data, and variables calculations.</textarea>
                </div>
            </section>

            <!-- Responses Section -->
            <section id="responses" class="admin-section">
                <h2>Response Templates</h2>
                
                <div class="responses-controls">
                    <button onclick="addNewTemplate()" class="btn-primary">+ Add Template</button>
                    <button onclick="importTemplates()" class="btn-secondary">üì• Import</button>
                    <button onclick="exportTemplates()" class="btn-secondary">üì§ Export</button>
                </div>

                <div class="templates-container" id="templatesContainer">
                    <!-- Response templates will be loaded here -->
                </div>
            </section>

            <!-- Conversations Section -->
            <section id="conversations" class="admin-section">
                <h2>Conversation Analytics</h2>
                
                <div class="stats-grid">
                    <div class="stat-card">
                        <h3>Total Conversations</h3>
                        <div class="stat-value" id="totalConversations">-</div>
                    </div>
                    <div class="stat-card">
                        <h3>Total Messages</h3>
                        <div class="stat-value" id="totalMessages">-</div>
                    </div>
                    <div class="stat-card">
                        <h3>Avg. Response Time</h3>
                        <div class="stat-value" id="avgResponseTime">-</div>
                    </div>
                    <div class="stat-card">
                        <h3>Success Rate</h3>
                        <div class="stat-value" id="successRate">-</div>
                    </div>
                </div>

                <div class="conversations-table">
                    <h3>Recent Conversations</h3>
                    <table id="conversationsTable">
                        <thead>
                            <tr>
                                <th>ID</th>
                                <th>Started</th>
                                <th>Messages</th>
                                <th>Duration</th>
                                <th>Status</th>
                                <th>Actions</th>
                            </tr>
                        </thead>
                        <tbody>
                            <!-- Conversations will be loaded here -->
                        </tbody>
                    </table>
                </div>
            </section>

            <!-- Integrations Section -->
            <section id="integrations" class="admin-section">
                <h2>Database Integrations</h2>
                
                <div class="integration-grid">
                    <div class="integration-card">
                        <h3>üåä PulseCore</h3>
                        <div class="integration-status" id="pulsecoreStatus">
                            <span class="status-indicator"></span>
                            <span class="status-text">Checking...</span>
                        </div>
                        <div class="time-toggle">
                            <button class="time-btn active" onclick="setPulseCoreTimeframe('week')">Week</button>
                            <button class="time-btn" onclick="setPulseCoreTimeframe('month')">Month</button>
                            <button class="time-btn" onclick="setPulseCoreTimeframe('all')">All Time</button>
                        </div>
                        <div class="integration-stats">
                            <p>Nova Events: <span id="novaCount">-</span></p>
                            <p>Climaxes: <span id="climaxesCount">-</span></p>
                            <p>Climax Groups: <span id="climaxCount">-</span></p>
                        </div>
                        <button onclick="testPulseCoreConnection()" class="btn-test">Test Connection</button>
                    </div>

                    <div class="integration-card">
                        <h3>üìä Variables</h3>
                        <div class="integration-status" id="variablesStatus">
                            <span class="status-indicator"></span>
                            <span class="status-text">Checking...</span>
                        </div>
                        <div class="integration-stats">
                            <p>Variables: <span id="variableCount">-</span></p>
                            <p>Calculations: <span id="calculationCount">-</span></p>
                            <p>Last Update: <span id="lastVarTime">-</span></p>
                        </div>
                        <button onclick="testVariablesConnection()" class="btn-test">Test Connection</button>
                    </div>

                    <div class="integration-card">
                        <h3>üñ•Ô∏è PC AI Server</h3>
                        <div class="integration-status" id="pcaiStatus">
                            <span class="status-indicator"></span>
                            <span class="status-text">Checking...</span>
                        </div>
                        <div class="integration-stats">
                            <p>Model: <span id="currentModel">-</span></p>
                            <p>GPU Memory: <span id="gpuMemory">-</span></p>
                            <p>Response Time: <span id="pcResponseTime">-</span></p>
                        </div>
                        <button onclick="testPCAIConnection()" class="btn-test">Test Connection</button>
                    </div>
                </div>
            </section>

            <!-- Learning Section -->
            <section id="learning" class="admin-section">
                <h2>AI Learning & Patterns</h2>
                
                <div class="learning-controls">
                    <label class="toggle-switch">
                        <input type="checkbox" id="learningEnabled" checked>
                        <span class="toggle-slider"></span>
                        Enable Learning from Conversations
                    </label>
                </div>

                <div class="learning-stats">
                    <h3>Learned Patterns</h3>
                    <div class="patterns-container" id="patternsContainer">
                        <!-- Learned patterns will be displayed here -->
                    </div>
                </div>

                <div class="learning-actions">
                    <button onclick="analyzeConversations()" class="btn-primary">üîç Analyze Conversations</button>
                    <button onclick="clearLearningData()" class="btn-danger">üóëÔ∏è Clear Learning Data</button>
                    <button onclick="exportLearningData()" class="btn-secondary">üì§ Export Patterns</button>
                </div>
            </section>

            <!-- Console Section -->
            <section id="console" class="admin-section">
                <!-- Green Debug Console - Centered and 2/3 width -->
                <div class="console-container">
                    <div id="debugInfo" class="green-console">
                        <div class="console-header-row">
                            <strong>üîç Debug Console</strong>
                            <div class="console-mode-toggle-mini">
                                <button id="debugModeBtn" class="toggle-btn-mini active" onclick="switchConsoleMode('debug')">üîß Debug</button>
                                <button id="browserModeBtn" class="toggle-btn-mini" onclick="switchConsoleMode('browser')">üåê Browser</button>
                            </div>
                            <div class="console-controls">
                                <button onclick="clearDebugOutput()" class="console-btn clear-btn">Clear</button>
                                <button onclick="toggleDebugAutoScroll()" id="autoScrollBtn" class="console-btn auto-scroll-btn">Auto-scroll: ON</button>
                            </div>
                        </div>
                        <div id="debugOutput" class="green-console-output">
                            <div style="color: #00ff88; font-size: 11px;">[System] Debug console initialized. Type "help" to see available commands.</div>
                            <div style="color: #00ff88; font-size: 11px; opacity: 0.7;">[Info] Console ready for debugging and API testing</div>
                        </div>
                        <div class="console-input-row">
                            <input type="text" id="debugCommand" placeholder="Enter command (help for list)" class="green-console-input">
                            <button onclick="executeDebugCommand()" class="console-btn run-btn">Run</button>
                            <div class="console-mode-indicator">
                                <span id="modeIndicator">Debug Mode</span>
                            </div>
                        </div>
                    </div>
                </div>
                
                <h2>Debug Console</h2>
                <p class="section-description">Interactive debugging console for testing APIs, monitoring connections, and troubleshooting issues in real-time.</p>
                
                <!-- Command Reference Info Box -->
                <div class="command-reference-box">
                    <div class="command-reference-header">
                        <h3>üìö Command Reference</h3>
                        <div class="reference-mode-indicator">
                            <span id="referenceMode">Debug Commands</span>
                        </div>
                    </div>
                    
                    <!-- Debug Commands Reference -->
                    <div id="debugCommandsRef" class="commands-list active">
                        <div class="command-category">
                            <h4>üîß System Commands</h4>
                            <div class="command-grid">
                                <div class="command-item">
                                    <code>help</code>
                                    <span>Show all available commands</span>
                                </div>
                                <div class="command-item">
                                    <code>status</code>
                                    <span>Check overall system status</span>
                                </div>
                                <div class="command-item">
                                    <code>time</code>
                                    <span>Display current date and time</span>
                                </div>
                                <div class="command-item">
                                    <code>clear</code>
                                    <span>Clear console output</span>
                                </div>
                                <div class="command-item">
                                    <code>memory</code>
                                    <span>Show browser memory usage</span>
                                </div>
                                <div class="command-item">
                                    <code>logs</code>
                                    <span>Display recent console logs</span>
                                </div>
                            </div>
                        </div>
                        
                        <div class="command-category">
                            <h4>üåä API Testing</h4>
                            <div class="command-grid">
                                <div class="command-item">
                                    <code>pulse</code>
                                    <span>Test PulseCore API connection</span>
                                </div>
                                <div class="command-item">
                                    <code>vars</code>
                                    <span>Test Variables API connection</span>
                                </div>
                                <div class="command-item">
                                    <code>db</code>
                                    <span>Test all database connections</span>
                                </div>
                                <div class="command-item">
                                    <code>api</code>
                                    <span>List all API endpoints</span>
                                </div>
                                <div class="command-item">
                                    <code>test [endpoint]</code>
                                    <span>Test specific endpoint (pulsecore, vars, etc.)</span>
                                </div>
                            </div>
                        </div>
                    </div>
                    
                    <!-- Browser Commands Reference -->
                    <div id="browserCommandsRef" class="commands-list">
                        <div class="command-category">
                            <h4>üåê DOM & Window</h4>
                            <div class="command-grid">
                                <div class="command-item">
                                    <code>document.title</code>
                                    <span>Get/set page title</span>
                                </div>
                                <div class="command-item">
                                    <code>window.location.href</code>
                                    <span>Get current URL</span>
                                </div>
                                <div class="command-item">
                                    <code>document.querySelector('.class')</code>
                                    <span>Select DOM element</span>
                                </div>
                                <div class="command-item">
                                    <code>document.querySelectorAll('.class')</code>
                                    <span>Select multiple DOM elements</span>
                                </div>
                                <div class="command-item">
                                    <code>window.innerWidth</code>
                                    <span>Get window width</span>
                                </div>
                                <div class="command-item">
                                    <code>document.body.style.background</code>
                                    <span>Change page styling</span>
                                </div>
                            </div>
                        </div>
                        
                        <div class="command-category">
                            <h4>üîß Console & Debug</h4>
                            <div class="command-grid">
                                <div class="command-item">
                                    <code>console.log("message")</code>
                                    <span>Log message to console</span>
                                </div>
                                <div class="command-item">
                                    <code>console.table(object)</code>
                                    <span>Display object as table</span>
                                </div>
                                <div class="command-item">
                                    <code>Object.keys(window)</code>
                                    <span>List window properties</span>
                                </div>
                                <div class="command-item">
                                    <code>localStorage</code>
                                    <span>Access browser storage</span>
                                </div>
                                <div class="command-item">
                                    <code>performance.memory</code>
                                    <span>Check memory usage</span>
                                </div>
                                <div class="command-item">
                                    <code>navigator.userAgent</code>
                                    <span>Get browser info</span>
                                </div>
                            </div>
                        </div>
                        
                        <div class="command-category">
                            <h4>üßÆ JavaScript Utils</h4>
                            <div class="command-grid">
                                <div class="command-item">
                                    <code>Math.random()</code>
                                    <span>Generate random number</span>
                                </div>
                                <div class="command-item">
                                    <code>new Date()</code>
                                    <span>Get current date/time</span>
                                </div>
                                <div class="command-item">
                                    <code>JSON.stringify(object)</code>
                                    <span>Convert object to JSON</span>
                                </div>
                                <div class="command-item">
                                    <code>JSON.parse(string)</code>
                                    <span>Parse JSON string</span>
                                </div>
                                <div class="command-item">
                                    <code>Array.from({length: 5}, (_, i) => i)</code>
                                    <span>Create arrays with data</span>
                                </div>
                                <div class="command-item">
                                    <code>fetch('/api/endpoint')</code>
                                    <span>Make HTTP requests</span>
                                </div>
                            </div>
                        </div>
                    </div>
                </div>
            </section>
        </main>
    </div>

    <!-- Conversation View Modal -->
    <div id="conversationModal" class="modal-overlay hidden">
        <div class="modal-container">
            <div class="modal-header">
                <h2 id="conversationTitle">Conversation Details</h2>
                <button class="modal-close" onclick="closeConversationModal()">‚úï</button>
            </div>
            <div class="modal-body">
                <div class="conversation-info">
                    <div class="info-row">
                        <span class="info-label">Conversation ID:</span>
                        <span id="conversationId">-</span>
                    </div>
                    <div class="info-row">
                        <span class="info-label">Started:</span>
                        <span id="conversationStarted">-</span>
                    </div>
                    <div class="info-row">
                        <span class="info-label">Total Messages:</span>
                        <span id="conversationMessages">-</span>
                    </div>
                    <div class="info-row">
                        <span class="info-label">Duration:</span>
                        <span id="conversationDuration">-</span>
                    </div>
                </div>
                <div class="conversation-thread">
                    <h3>Message Thread</h3>
                    <div class="thread-container" id="threadContainer">
                        <div class="loading-spinner">Loading conversation...</div>
                    </div>
                </div>
            </div>
        </div>
    </div>

    <script src="../js/admin.js"></script>
</body>
</html>