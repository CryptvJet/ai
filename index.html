<!DOCTYPE html>
<html lang="en">
<head>
    <meta charset="UTF-8">
    <meta name="viewport" content="width=device-width, initial-scale=1.0">
    <title>AI Chat Interface</title>
    <link rel="stylesheet" href="css/chat.css">
    <link rel="stylesheet" href="css/ai-site.css">
</head>
<body>
    <div class="app-layout">
        <!-- Left Sidebar (1/6 width) -->
        <div class="left-sidebar">
            <!-- Future left sidebar content -->
        </div>

        <!-- Main Chat Area (2/3 width) -->
        <div class="chat-main">
            <header class="chat-header">
                <div class="header-left">
                    <div class="ai-avatar">ü§ñ</div>
                    <h1 id="aiName">AI Assistant</h1>
                    <span id="aiMode" class="mode-indicator chill">Chill Mode</span>
                    <button id="journalModeBtn" class="btn-journal-mode" onclick="toggleJournalMode()" title="Switch to Journal Mode">üìù Journal</button>
                    <span id="pulseStatus" class="connection-status">PulseCore: <span class="status-dot"></span></span>
                    <span id="pcStatus" class="connection-status">PC Bridge: <span class="status-dot"></span></span>
                </div>
                <div class="controls">
                    <button id="adminBtn" class="btn-admin" onclick="openAdmin()">‚öôÔ∏è My Admin</button>
                    <button id="clearBtn" class="btn-clear" onclick="clearChat()">üóëÔ∏è Clear</button>
                </div>
            </header>

            <div class="chat-container" id="chatContainer">
                <div class="message ai-message" id="welcomeMessage">
                    <div class="message-content">
                        <strong id="aiNameLabel">AI:</strong> <span id="welcomeText">Hi! I'm your AI Assistant. I hope you are doing well today! What should I call you?</span>
                    </div>
                    <div class="message-time"></div>
                </div>
            </div>

            <!-- Regular Chat Input Section -->
            <div class="input-section" id="regularInputSection">
                <div class="input-container">
                    <input 
                        type="text" 
                        id="messageInput" 
                        placeholder="Type your message or press the microphone to speak..."
                        autocomplete="off"
                    />
                    <button id="voiceBtn" class="btn-voice" onclick="toggleVoice()" title="Voice input">
                        üé§
                    </button>
                    <button id="sendBtn" class="btn-send" onclick="sendMessage()" title="Send message">
                        ‚û§
                    </button>
                </div>

                <div class="quick-actions">
                    <button class="quick-btn" onclick="quickMessage('What are my recent novas?')">Recent Novas</button>
                    <button class="quick-btn" onclick="quickMessage('Analyze my patterns')">Pattern Analysis</button>
                    <button class="quick-btn" onclick="quickMessage('Help me optimize')">Optimization Tips</button>
                    <button class="quick-btn" onclick="quickMessage('Show variables data')">Variables Data</button>
                </div>
            </div>

            <!-- Journal Mode Interface -->
            <div class="journal-section hidden" id="journalSection">
                <div class="journal-controls">
                    <div class="journal-status">
                        <span id="journalStatus" class="journal-status-text">Ready to record</span>
                        <span id="journalTimer" class="journal-timer">00:00</span>
                    </div>
                    <div class="journal-buttons">
                        <button id="startVoiceBtn" class="btn-journal-voice start" onclick="startJournalVoice()" title="Start Voice Recording">
                            üî¥ Start Voice
                        </button>
                        <button id="stopVoiceBtn" class="btn-journal-voice stop" onclick="stopJournalVoice()" disabled title="Stop Voice Recording">
                            ‚èπÔ∏è Stop Voice
                        </button>
                        <button id="pauseVoiceBtn" class="btn-journal-voice pause" onclick="pauseJournalVoice()" disabled title="Pause Voice Recording">
                            ‚è∏Ô∏è Pause
                        </button>
                    </div>
                </div>

                <div class="journal-editor">
                    <textarea 
                        id="journalText" 
                        class="journal-textarea" 
                        placeholder="Your journal will appear here as you speak... You can also type directly or edit the text."
                        rows="12"
                    ></textarea>
                </div>

                <div class="journal-ai-panel">
                    <div class="journal-ai-input">
                        <input 
                            type="text" 
                            id="journalAiInput" 
                            placeholder="Ask Zin about your writing, get suggestions, or analyze your journal..."
                            class="journal-ai-message-input"
                        />
                        <button id="journalAiSendBtn" class="btn-journal-ai-send" onclick="sendJournalAiMessage()">
                            ü§ñ Ask Zin
                        </button>
                    </div>
                    <div class="journal-ai-response" id="journalAiResponse">
                        <p class="journal-ai-welcome">Hi! I'm Zin, your writing companion. I can help analyze your journal entries, suggest improvements, or discuss your thoughts. What would you like to explore?</p>
                    </div>
                </div>

                <div class="journal-actions">
                    <button id="saveJournalBtn" class="btn-journal-action save" onclick="saveJournalEntry()">
                        üíæ Save Entry
                    </button>
                    <button id="clearJournalBtn" class="btn-journal-action clear" onclick="clearJournalEntry()">
                        üóëÔ∏è Clear
                    </button>
                    <button id="exportJournalBtn" class="btn-journal-action export" onclick="exportJournalEntry()">
                        üì§ Export
                    </button>
                </div>
            </div>
        </div>

        <!-- Right Stats Sidebar (1/6 width) -->
        <div class="right-sidebar">
            <div class="stats-toggle-section">
                <button id="statsToggle" class="stats-toggle" onclick="toggleStats()">
                    üìä PulseCore Stats
                    <span class="toggle-arrow" id="statsArrow">‚ñ≤</span>
                </button>
            </div>

            <div class="stats-card" id="statsPanel">
                <div class="stat-item">
                    <span class="stat-label">Total Climaxes:</span>
                    <span class="stat-value" id="totalClimaxes">-</span>
                </div>
                <div class="stat-item">
                    <span class="stat-label">Total Novas:</span>
                    <span class="stat-value" id="totalNovas">-</span>
                </div>
                <div class="stat-item">
                    <span class="stat-label">Average Complexity:</span>
                    <span class="stat-value" id="avgComplexity">-</span>
                </div>
                <div class="stat-item">
                    <span class="stat-label">Total Sessions:</span>
                    <span class="stat-value" id="totalSessions">-</span>
                </div>
            </div>

            <div class="voice-toggle-section">
                <button id="voiceControlsToggle" class="voice-controls-toggle" onclick="toggleVoiceControls()">
                    üéõÔ∏è Voice Settings
                    <span class="toggle-arrow" id="toggleArrow">‚ñº</span>
                </button>
            </div>

            <div class="voice-controls collapsed" id="voiceControlsPanel">
                <div class="voice-settings">
                    <div class="voice-row">
                        <select id="voiceSelect" class="voice-dropdown">
                            <option value="">Loading voices...</option>
                        </select>
                        <div class="voice-speed">
                            <label for="speechRate">Speed:</label>
                            <input type="range" id="speechRate" min="0.5" max="2.5" step="0.1" value="1.2" class="speed-slider">
                            <span id="speedValue">1.2x</span>
                        </div>
                    </div>
                    
                    <div class="voice-row">
                        <div class="voice-pitch">
                            <label for="speechPitch">Pitch:</label>
                            <input type="range" id="speechPitch" min="0.5" max="2.0" step="0.1" value="1.0" class="pitch-slider">
                            <span id="pitchValue">1.0</span>
                        </div>
                        <div class="voice-volume">
                            <label for="speechVolume">Volume:</label>
                            <input type="range" id="speechVolume" min="0.1" max="1.0" step="0.1" value="0.8" class="volume-slider">
                            <span id="volumeValue">0.8</span>
                        </div>
                    </div>

                    <div class="voice-row">
                        <label class="voice-toggle">
                            <input type="checkbox" id="autoSpeak" checked>
                            <span class="toggle-slider-mini"></span>
                            Auto-speak
                        </label>
                        
                        <div class="voice-timeout">
                            <label for="voiceTimeout">Listen Duration:</label>
                            <select id="voiceTimeout" class="timeout-dropdown">
                                <option value="normal">Normal</option>
                                <option value="30">30 seconds</option>
                                <option value="60">60 seconds</option>
                                <option value="continuous">Continuous</option>
                            </select>
                        </div>
                    </div>

                    <div class="voice-test">
                        <button id="testVoiceBtn" class="btn-test-voice">üéµ Test Voice</button>
                        <button id="micTestBtn" class="btn-test-voice">üîß Test Mic</button>
                        <button id="voiceSettingsBtn" class="btn-voice-settings">‚öôÔ∏è Advanced</button>
                    </div>
                </div>
            </div>
        </div>
    </div>

    <div id="voiceIndicator" class="voice-indicator hidden">
        <button class="voice-close-btn" onclick="closeVoiceIndicator()">‚úï</button>
        <div class="voice-animation"></div>
        <p>Listening... Speak now</p>
        <div class="voice-status" id="voiceStatus">Ready to listen...</div>
    </div>

    <!-- Advanced Voice Settings Modal -->
    <div id="advancedVoiceModal" class="voice-modal hidden">
        <div class="modal-content">
            <div class="modal-header">
                <h2>üéõÔ∏è Advanced Voice Settings</h2>
                <button class="modal-close" onclick="closeAdvancedVoiceSettings()">‚úï</button>
            </div>
            
            <div class="modal-body">
                <div class="settings-tabs">
                    <button class="tab-button active" data-tab="recognition">üé§ Recognition</button>
                    <button class="tab-button" data-tab="synthesis">üîä Speech Output</button>
                    <button class="tab-button" data-tab="behavior">‚öôÔ∏è Behavior</button>
                    <button class="tab-button" data-tab="diagnostics">üîß Diagnostics</button>
                </div>

                <!-- Recognition Settings Tab -->
                <div class="tab-content active" id="tab-recognition">
                    <h3>üé§ Voice Recognition Settings</h3>
                    
                    <div class="setting-group">
                        <label>Language & Region:</label>
                        <select id="recognitionLang" class="setting-select">
                            <option value="en-US">English (US)</option>
                            <option value="en-GB">English (UK)</option>
                            <option value="en-AU">English (Australia)</option>
                            <option value="en-CA">English (Canada)</option>
                            <option value="es-ES">Spanish (Spain)</option>
                            <option value="es-MX">Spanish (Mexico)</option>
                            <option value="fr-FR">French (France)</option>
                            <option value="de-DE">German</option>
                            <option value="it-IT">Italian</option>
                            <option value="pt-BR">Portuguese (Brazil)</option>
                            <option value="ja-JP">Japanese</option>
                            <option value="ko-KR">Korean</option>
                            <option value="zh-CN">Chinese (Simplified)</option>
                        </select>
                    </div>

                    <div class="setting-group">
                        <label>Recognition Sensitivity:</label>
                        <input type="range" id="recognitionSensitivity" min="0.1" max="1.0" step="0.1" value="0.7">
                        <span id="sensitivityValue">0.7</span>
                        <div class="setting-help">Higher = picks up quieter speech, but may catch background noise</div>
                    </div>

                    <div class="setting-group">
                        <label>Noise Reduction:</label>
                        <select id="noiseReduction" class="setting-select">
                            <option value="auto">Auto</option>
                            <option value="high">High</option>
                            <option value="medium">Medium</option>
                            <option value="low">Low</option>
                            <option value="off">Off</option>
                        </select>
                    </div>

                    <div class="setting-group">
                        <label>Alternative Results:</label>
                        <select id="maxAlternatives" class="setting-select">
                            <option value="1">1 (fastest)</option>
                            <option value="3">3 (balanced)</option>
                            <option value="5">5 (most accurate)</option>
                        </select>
                        <div class="setting-help">More alternatives = better accuracy but slower processing</div>
                    </div>

                    <div class="setting-group">
                        <label class="checkbox-label">
                            <input type="checkbox" id="interimResults" checked>
                            <span class="checkmark"></span>
                            Show partial results while speaking
                        </label>
                    </div>

                    <div class="setting-group">
                        <label class="checkbox-label">
                            <input type="checkbox" id="continuousRecognition" checked>
                            <span class="checkmark"></span>
                            Continuous recognition mode
                        </label>
                    </div>
                </div>

                <!-- Speech Synthesis Tab -->
                <div class="tab-content" id="tab-synthesis">
                    <h3>üîä Text-to-Speech Settings</h3>
                    
                    <div class="setting-group voice-selector-group">
                        <label>Voice Selection & Preview:</label>
                        
                        <!-- Voice Search and Filters -->
                        <div class="voice-controls">
                            <input type="text" id="voiceSearch" class="voice-search" placeholder="üîç Search voices by name, language, or accent...">
                            <div class="voice-filters">
                                <select id="languageFilter" class="filter-select">
                                    <option value="">All Languages</option>
                                </select>
                                <select id="genderFilter" class="filter-select">
                                    <option value="">All Genders</option>
                                    <option value="female">Female</option>
                                    <option value="male">Male</option>
                                    <option value="neutral">Neutral</option>
                                </select>
                                <select id="qualityFilter" class="filter-select">
                                    <option value="">All Quality</option>
                                    <option value="premium">Premium</option>
                                    <option value="standard">Standard</option>
                                    <option value="neural">Neural</option>
                                </select>
                                <button id="clearFilters" class="btn-small">üßπ Clear</button>
                            </div>
                        </div>

                        <!-- Voice Grid Display -->
                        <div class="voices-grid" id="voicesGrid">
                            <div class="loading-voices">Loading available voices...</div>
                        </div>

                        <!-- Selected Voice Display -->
                        <div class="selected-voice-display" id="selectedVoiceDisplay">
                            <div class="no-voice-selected">
                                <span>üé≠ No voice selected - using browser default</span>
                            </div>
                        </div>

                        <!-- Voice Testing Panel -->
                        <div class="voice-testing-panel">
                            <div class="test-controls">
                                <textarea id="voiceTestText" class="test-text" placeholder="Enter custom text to test voices..."
                                >Hello! I'm testing this voice. How do I sound? This is a longer sentence to showcase the voice quality and characteristics.</textarea>
                                <div class="test-buttons">
                                    <button id="testSelectedVoice" class="btn-test">üéµ Test Selected Voice</button>
                                    <button id="testRandomVoice" class="btn-test">üé≤ Test Random Voice</button>
                                    <button id="compareVoices" class="btn-test">‚öñÔ∏è Compare Top 3</button>
                                    <button id="voiceRecommendations" class="btn-test">‚≠ê Get Recommendations</button>
                                </div>
                            </div>
                        </div>

                        <!-- Voice Comparison Panel (hidden by default) -->
                        <div class="voice-comparison-panel hidden" id="voiceComparisonPanel">
                            <h4>üîä Voice Comparison</h4>
                            <div class="comparison-voices" id="comparisonVoices">
                                <!-- Dynamically populated -->
                            </div>
                            <button id="closeComparison" class="btn-small">‚úñ Close Comparison</button>
                        </div>

                        <!-- Legacy Simple Selector (for compatibility) -->
                        <details class="legacy-selector">
                            <summary>üìú Simple Voice Selector (Legacy)</summary>
                            <select id="advancedVoiceSelect" class="setting-select">
                                <option value="">Loading voices...</option>
                            </select>
                            <button id="previewVoiceBtn" class="btn-small">‚ñ∂Ô∏è Preview</button>
                        </details>
                    </div>

                    <div class="setting-group">
                        <label>Speech Rate:</label>
                        <input type="range" id="advancedSpeechRate" min="0.1" max="3.0" step="0.1" value="1.2">
                        <span id="advancedSpeedValue">1.2x</span>
                        <div class="rate-presets">
                            <button class="preset-btn" data-rate="0.5">Slow</button>
                            <button class="preset-btn" data-rate="1.0">Normal</button>
                            <button class="preset-btn" data-rate="1.2">Fast</button>
                            <button class="preset-btn" data-rate="1.8">Very Fast</button>
                        </div>
                    </div>

                    <div class="setting-group">
                        <label>Pitch:</label>
                        <input type="range" id="advancedSpeechPitch" min="0.1" max="2.0" step="0.1" value="1.0">
                        <span id="advancedPitchValue">1.0</span>
                        <div class="pitch-presets">
                            <button class="preset-btn" data-pitch="0.7">Low</button>
                            <button class="preset-btn" data-pitch="1.0">Normal</button>
                            <button class="preset-btn" data-pitch="1.3">High</button>
                        </div>
                    </div>

                    <div class="setting-group">
                        <label>Volume:</label>
                        <input type="range" id="advancedSpeechVolume" min="0.0" max="1.0" step="0.1" value="0.8">
                        <span id="advancedVolumeValue">0.8</span>
                        <button id="testVolumeBtn" class="btn-small">üîä Test</button>
                    </div>

                    <div class="setting-group">
                        <label>Pause Between Sentences:</label>
                        <input type="range" id="sentencePause" min="0" max="2000" step="100" value="500">
                        <span id="pauseValue">500ms</span>
                    </div>

                    <div class="setting-group">
                        <label class="checkbox-label">
                            <input type="checkbox" id="advancedAutoSpeak" checked>
                            <span class="checkmark"></span>
                            Automatically speak AI responses
                        </label>
                    </div>

                    <div class="setting-group">
                        <label class="checkbox-label">
                            <input type="checkbox" id="speakPunctuation">
                            <span class="checkmark"></span>
                            Pronounce punctuation marks
                        </label>
                    </div>
                </div>

                <!-- Behavior Settings Tab -->
                <div class="tab-content" id="tab-behavior">
                    <h3>‚öôÔ∏è Voice Behavior Settings</h3>
                    
                    <div class="setting-group">
                        <label>Default Listening Duration:</label>
                        <select id="defaultVoiceTimeout" class="setting-select">
                            <option value="normal">5 seconds (Normal)</option>
                            <option value="15">15 seconds</option>
                            <option value="30">30 seconds</option>
                            <option value="60">1 minute</option>
                            <option value="120">2 minutes</option>
                            <option value="continuous">Continuous</option>
                        </select>
                    </div>

                    <div class="setting-group">
                        <label class="checkbox-label">
                            <input type="checkbox" id="autoSendOnSilence" checked>
                            <span class="checkmark"></span>
                            Auto-send message after silence
                        </label>
                        <div class="setting-help">Automatically send when you stop speaking</div>
                    </div>

                    <div class="setting-group">
                        <label class="checkbox-label">
                            <input type="checkbox" id="wakeWords">
                            <span class="checkmark"></span>
                            Wake word activation ("Hey AI")
                        </label>
                        <div class="setting-help">Start listening when you say "Hey AI" or "Hello AI"</div>
                    </div>

                    <div class="setting-group">
                        <label class="checkbox-label">
                            <input type="checkbox" id="voiceConfirmation">
                            <span class="checkmark"></span>
                            Voice confirmation sounds
                        </label>
                    </div>

                    <div class="setting-group">
                        <label class="checkbox-label">
                            <input type="checkbox" id="stopOnClick">
                            <span class="checkmark"></span>
                            Stop speaking when clicking anywhere
                        </label>
                    </div>

                    <div class="setting-group">
                        <label>Voice Commands:</label>
                        <div class="command-list">
                            <div class="command-item">
                                <strong>"Stop listening"</strong> - End voice recognition
                            </div>
                            <div class="command-item">
                                <strong>"Clear chat"</strong> - Clear conversation
                            </div>
                            <div class="command-item">
                                <strong>"Repeat that"</strong> - Repeat last AI response
                            </div>
                            <div class="command-item">
                                <strong>"Louder" / "Quieter"</strong> - Adjust volume
                            </div>
                        </div>
                    </div>
                </div>

                <!-- Diagnostics Tab -->
                <div class="tab-content" id="tab-diagnostics">
                    <h3>üîß Voice Diagnostics & Testing</h3>
                    
                    <div class="diagnostic-section">
                        <h4>System Status:</h4>
                        <div id="diagnosticStatus" class="status-grid">
                            <div class="status-item">
                                <span class="status-label">Browser Support:</span>
                                <span id="browserSupportStatus" class="status-value">Checking...</span>
                            </div>
                            <div class="status-item">
                                <span class="status-label">Microphone Access:</span>
                                <span id="micAccessStatus" class="status-value">Checking...</span>
                            </div>
                            <div class="status-item">
                                <span class="status-label">Speech Synthesis:</span>
                                <span id="speechSynthStatus" class="status-value">Checking...</span>
                            </div>
                            <div class="status-item">
                                <span class="status-label">Network Connection:</span>
                                <span id="networkStatus" class="status-value">Checking...</span>
                            </div>
                        </div>
                    </div>

                    <div class="diagnostic-section">
                        <h4>Quick Tests:</h4>
                        <div class="test-buttons">
                            <button id="testMicrophoneBtn" class="test-btn">üé§ Test Microphone</button>
                            <button id="testSpeechBtn" class="test-btn">üîä Test Speech</button>
                            <button id="testFullCycleBtn" class="test-btn">üîÑ Test Full Cycle</button>
                            <button id="voiceCalibrationBtn" class="test-btn">üìä Voice Calibration</button>
                        </div>
                    </div>

                    <div class="diagnostic-section">
                        <h4>Audio Levels:</h4>
                        <div class="audio-level-container">
                            <label>Microphone Input Level:</label>
                            <div class="audio-meter">
                                <div id="audioLevelBar" class="level-bar"></div>
                            </div>
                            <span id="audioLevelText">0%</span>
                        </div>
                    </div>

                    <div class="diagnostic-section">
                        <h4>Performance Metrics:</h4>
                        <div class="metrics-grid">
                            <div class="metric-item">
                                <span class="metric-label">Recognition Accuracy:</span>
                                <span id="recognitionAccuracy" class="metric-value">-</span>
                            </div>
                            <div class="metric-item">
                                <span class="metric-label">Average Response Time:</span>
                                <span id="avgResponseTime" class="metric-value">-</span>
                            </div>
                            <div class="metric-item">
                                <span class="metric-label">Voice Sessions Today:</span>
                                <span id="voiceSessionCount" class="metric-value">-</span>
                            </div>
                        </div>
                    </div>

                    <div class="diagnostic-section">
                        <h4>Debug Console:</h4>
                        <div id="debugConsole" class="debug-console"></div>
                        <button id="clearDebugBtn" class="btn-small">Clear Debug</button>
                        <button id="exportDebugBtn" class="btn-small">Export Debug Log</button>
                    </div>
                </div>
            </div>

            <div class="modal-footer">
                <button id="resetVoiceSettings" class="btn-secondary">üîÑ Reset to Defaults</button>
                <button id="saveVoiceSettings" class="btn-primary">üíæ Save Settings</button>
                <button id="exportVoiceSettings" class="btn-secondary">üì§ Export Settings</button>
                <button id="importVoiceSettings" class="btn-secondary">üì• Import Settings</button>
            </div>
        </div>
    </div>

    <script src="js/chat.js"></script>
</body>
</html>